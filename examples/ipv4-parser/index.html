<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>IPv4 Parser - Complete Example | Cedric Bail</title>
<meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Full SPMD IPv4 address parser implementation"><meta name=generator content="Hugo 0.136.0"><meta name=robots content="index, follow"><meta name=author content="Cedric Bail"><link rel=stylesheet href=/ananke/css/main.min.b27b18f294c9951b5b631d08d9733f0d7794f951b8e49cdde160a91f5a65f320.css><link rel=canonical href=http://bluebugs.github.io/examples/ipv4-parser/><meta property="og:url" content="http://bluebugs.github.io/examples/ipv4-parser/"><meta property="og:site_name" content="Cedric Bail"><meta property="og:title" content="IPv4 Parser - Complete Example"><meta property="og:description" content="Full SPMD IPv4 address parser implementation"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="examples"><meta property="article:published_time" content="2025-07-13T15:00:00-07:00"><meta property="article:modified_time" content="2025-07-13T15:00:00-07:00"><meta property="article:tag" content="Golang"><meta property="article:tag" content="Performance"><meta property="article:tag" content="Networking"><meta property="article:tag" content="SIMD"><meta property="article:tag" content="SPMD"><meta itemprop=name content="IPv4 Parser - Complete Example"><meta itemprop=description content="Full SPMD IPv4 address parser implementation"><meta itemprop=datePublished content="2025-07-13T15:00:00-07:00"><meta itemprop=dateModified content="2025-07-13T15:00:00-07:00"><meta itemprop=wordCount content="704"><meta itemprop=keywords content="Golang,Performance,Networking,SIMD,SPMD"><meta name=twitter:card content="summary"><meta name=twitter:title content="IPv4 Parser - Complete Example"><meta name=twitter:description content="Full SPMD IPv4 address parser implementation"></head><body class="ma0 avenir bg-near-white production"><header class="cover bg-center" style=background-image:url(http://bluebugs.github.io/images/bugaboo.jpg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Cedric Bail</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blogs/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/examples/ title="Code Examples page">Code Examples</a></li></ul><div class=ananke-socials></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><div class="f2 f1-l fw2 white-90 mb0 lh-title">IPv4 Parser - Complete Example</div><div class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">Full SPMD IPv4 address parser implementation</div></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Code Examples</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">IPv4 Parser - Complete Example</h1><p class=tracked>By <strong>Cedric Bail</strong></p><time class="f6 mv4 dib tracked" datetime=2025-07-13T15:00:00-07:00>July 13, 2025</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links black pr4-l w-two-thirds-l"><p>This is the complete implementation of the high-performance IPv4 address parser discussed in <a href=../../blogs/go-spmd-ipv4-parser/>Putting It All Together: Fast IPv4 Parsing with SPMD Go</a>.</p><h2 id=complete-source-code>Complete Source Code</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Package main demonstrates SPMD IPv4 address parsing using 16-lane processing
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Based on: https://github.com/WojciechMula/toys/blob/master/parseip4/sse_v7.cpp.inl
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;math/bits&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;reduce&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>parseAddrError</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>in</span>  <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>msg</span> <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>at</span>  <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>e</span> <span style=color:#a6e22e>parseAddrError</span>) <span style=color:#a6e22e>Error</span>() <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>at</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;parse %q: %s (at %q)&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>in</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>msg</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>at</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprintf</span>(<span style=color:#e6db74>&#34;parse %q: %s&#34;</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>in</span>, <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>msg</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// parseIPv4 processes IPv4 addresses using 16-lane SPMD similar to Wojciech&#39;s SSE approach
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>parseIPv4</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>) ([<span style=color:#ae81ff>4</span>]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>s</span>) &lt; <span style=color:#ae81ff>7</span> <span style=color:#f92672>||</span> len(<span style=color:#a6e22e>s</span>) &gt; <span style=color:#ae81ff>15</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> [<span style=color:#ae81ff>4</span>]<span style=color:#66d9ef>byte</span>{}, <span style=color:#a6e22e>parseAddrError</span>{<span style=color:#a6e22e>in</span>: <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>msg</span>: <span style=color:#e6db74>&#34;IPv4 address string too short or too long&#34;</span>}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Pad string to 16 bytes with null terminators (like SSE register)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>input</span> <span style=color:#f92672>:=</span> [<span style=color:#ae81ff>16</span>]<span style=color:#66d9ef>byte</span>{}
</span></span><span style=display:flex><span>	copy(<span style=color:#a6e22e>input</span>[:], <span style=color:#a6e22e>s</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Process all 16 lanes in parallel
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>dotMaskTotal</span> <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>16</span>] <span style=color:#66d9ef>uint8</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>dotMask</span> <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>16</span>] <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>digitMask</span> <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>16</span>] <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>validChars</span> <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>16</span>] <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>c</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span>[<span style=color:#ae81ff>16</span>] <span style=color:#a6e22e>input</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>dotMask</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#a6e22e>c</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;.&#39;</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>dotMask</span>[<span style=color:#a6e22e>i</span>] {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>dotMaskTotal</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>digitMask</span>[<span style=color:#a6e22e>i</span>] = (<span style=color:#a6e22e>c</span> <span style=color:#f92672>&gt;=</span> <span style=color:#e6db74>&#39;0&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>&lt;=</span> <span style=color:#e6db74>&#39;9&#39;</span>)
</span></span><span style=display:flex><span>		
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Valid if dot, digit, or null (padding)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>validChars</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#a6e22e>dotMask</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>||</span> <span style=color:#a6e22e>digitMask</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>||</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Check character validity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>reduce</span>.<span style=color:#a6e22e>All</span>(<span style=color:#a6e22e>validChars</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> [<span style=color:#ae81ff>4</span>]<span style=color:#66d9ef>byte</span>{}, <span style=color:#a6e22e>parseAddrError</span>{<span style=color:#a6e22e>in</span>: <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>at</span>: <span style=color:#a6e22e>reduce</span>.<span style=color:#a6e22e>FindFirstSet</span>(<span style=color:#a6e22e>validChars</span>), <span style=color:#a6e22e>msg</span>: <span style=color:#e6db74>&#34;unexpected character&#34;</span>}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>dotCount</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reduce</span>.<span style=color:#a6e22e>Sum</span>(<span style=color:#a6e22e>dotMaskTotal</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>dotCount</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>3</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> [<span style=color:#ae81ff>4</span>]<span style=color:#66d9ef>byte</span>{}, <span style=color:#a6e22e>parseAddrError</span>{<span style=color:#a6e22e>in</span>: <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>msg</span>: <span style=color:#e6db74>&#34;invalid dot count&#34;</span>}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Create dot position bitmask from lanes (similar to _mm_movemask_epi8)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>dotPositionMask</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reduce</span>.<span style=color:#a6e22e>Mask</span>(<span style=color:#a6e22e>dotMask</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Extract dot positions (similar to Wojciech&#39;s pattern matching)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>dotPositions</span> [<span style=color:#ae81ff>3</span>]<span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>mask</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dotPositionMask</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>pos</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bits</span>.<span style=color:#a6e22e>TrailingZeros16</span>(<span style=color:#a6e22e>mask</span>)
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>dotPositions</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#a6e22e>pos</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>mask</span> <span style=color:#f92672>&amp;=</span> <span style=color:#a6e22e>mask</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Define field boundaries
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>starts</span> <span style=color:#f92672>:=</span> [<span style=color:#ae81ff>4</span>]<span style=color:#66d9ef>int</span>{<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>dotPositions</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>dotPositions</span>[<span style=color:#ae81ff>1</span>], <span style=color:#a6e22e>dotPositions</span>[<span style=color:#ae81ff>2</span>]}
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>ends</span> <span style=color:#f92672>:=</span> [<span style=color:#ae81ff>4</span>]<span style=color:#66d9ef>int</span>{<span style=color:#a6e22e>dotPositions</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>dotPositions</span>[<span style=color:#ae81ff>1</span>], <span style=color:#a6e22e>dotPositions</span>[<span style=color:#ae81ff>2</span>], len(<span style=color:#a6e22e>s</span>)}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Validate field lengths (following Wojciech&#39;s max digit approach)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>starts</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>end</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ends</span>[<span style=color:#a6e22e>i</span>]
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>i</span> &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>start</span><span style=color:#f92672>++</span> <span style=color:#75715e>// Skip the dot
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		}
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fieldLen</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>end</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>start</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>reduce</span>.<span style=color:#a6e22e>Any</span>(<span style=color:#a6e22e>fieldLen</span> &lt; <span style=color:#ae81ff>1</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>fieldLen</span> &gt; <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> [<span style=color:#ae81ff>4</span>]<span style=color:#66d9ef>byte</span>{}, <span style=color:#a6e22e>parseAddrError</span>{<span style=color:#a6e22e>in</span>: <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>msg</span>: <span style=color:#e6db74>&#34;invalid field length&#34;</span>}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Process all four fields in parallel using 4-lane processing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ip</span> [<span style=color:#ae81ff>4</span>]<span style=color:#66d9ef>byte</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>errors</span> [<span style=color:#ae81ff>4</span>]<span style=color:#a6e22e>parseAddrError</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>hasError</span> <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>4</span>] <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>field</span>, <span style=color:#a6e22e>start</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>starts</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>end</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ends</span>[<span style=color:#a6e22e>field</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>field</span> &gt; <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>start</span><span style=color:#f92672>++</span> <span style=color:#75715e>// Skip the dot
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>fieldLen</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>end</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>start</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>value</span> <span style=color:#66d9ef>int</span>
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>hasLeadingZero</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Convert field using parallel digit processing
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#75715e>// This mirrors Wojciech&#39;s SSE_CONVERT_MAX1/2/3 macros
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>fieldLen</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Single digit: direct conversion
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>value</span> = int(<span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>start</span>] <span style=color:#f92672>-</span> <span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#ae81ff>2</span>:
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Two digits: d1*10 + d0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>d1</span> <span style=color:#f92672>:=</span> int(<span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>start</span>] <span style=color:#f92672>-</span> <span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>d0</span> <span style=color:#f92672>:=</span> int(<span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>start</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>-</span> <span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>d1</span><span style=color:#f92672>*</span><span style=color:#ae81ff>10</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>d0</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>hasLeadingZero</span> = (<span style=color:#a6e22e>d1</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>case</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Three digits: d2*100 + d1*10 + d0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>d2</span> <span style=color:#f92672>:=</span> int(<span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>start</span>] <span style=color:#f92672>-</span> <span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>d1</span> <span style=color:#f92672>:=</span> int(<span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>start</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>-</span> <span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>d0</span> <span style=color:#f92672>:=</span> int(<span style=color:#a6e22e>s</span>[<span style=color:#a6e22e>start</span><span style=color:#f92672>+</span><span style=color:#ae81ff>2</span>] <span style=color:#f92672>-</span> <span style=color:#e6db74>&#39;0&#39;</span>)
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>value</span> = <span style=color:#a6e22e>d2</span><span style=color:#f92672>*</span><span style=color:#ae81ff>100</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>d1</span><span style=color:#f92672>*</span><span style=color:#ae81ff>10</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>d0</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>hasLeadingZero</span> = (<span style=color:#a6e22e>d2</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Validation (following Wojciech&#39;s approach)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>hasLeadingZero</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>errors</span>[<span style=color:#a6e22e>field</span>] = <span style=color:#a6e22e>parseAddrError</span>{<span style=color:#a6e22e>in</span>: <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>msg</span>: <span style=color:#e6db74>&#34;IPv4 field has octet with leading zero&#34;</span>}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>hasError</span>[<span style=color:#a6e22e>field</span>] = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>		} <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>value</span> &gt; <span style=color:#ae81ff>255</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>errors</span>[<span style=color:#a6e22e>field</span>] = <span style=color:#a6e22e>parseAddrError</span>{<span style=color:#a6e22e>in</span>: <span style=color:#a6e22e>s</span>, <span style=color:#a6e22e>msg</span>: <span style=color:#e6db74>&#34;IPv4 field has value &gt;255&#34;</span>}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>hasError</span>[<span style=color:#a6e22e>field</span>] = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>		} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>ip</span>[<span style=color:#a6e22e>field</span>] = uint8(<span style=color:#a6e22e>value</span>)
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>reduce</span>.<span style=color:#a6e22e>Any</span>(<span style=color:#a6e22e>hasError</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> [<span style=color:#ae81ff>4</span>]<span style=color:#66d9ef>byte</span>{}, <span style=color:#a6e22e>errors</span>[<span style=color:#a6e22e>reduce</span>.<span style=color:#a6e22e>FindFirstSet</span>(<span style=color:#a6e22e>hasError</span>)]
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ip</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=usage-example>Usage Example</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>testCases</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;192.168.1.1&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;10.0.0.1&#34;</span>, 
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;255.255.255.255&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;192.168.1.256&#34;</span>, <span style=color:#75715e>// Invalid: &gt;255
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#e6db74>&#34;192.168.01.1&#34;</span>,  <span style=color:#75715e>// Invalid: leading zero
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#e6db74>&#34;192.168.a.1&#34;</span>,   <span style=color:#75715e>// Invalid: non-digit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tc</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>testCases</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ip</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>parseIPv4</span>(<span style=color:#a6e22e>tc</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%-15s -&gt; ERROR: %s\n&#34;</span>, <span style=color:#a6e22e>tc</span>, <span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%-15s -&gt; %d.%d.%d.%d\n&#34;</span>, <span style=color:#a6e22e>tc</span>, <span style=color:#a6e22e>ip</span>[<span style=color:#ae81ff>0</span>], <span style=color:#a6e22e>ip</span>[<span style=color:#ae81ff>1</span>], <span style=color:#a6e22e>ip</span>[<span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>ip</span>[<span style=color:#ae81ff>3</span>])
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=source-material>Source material</h2><p>This implementation is inspired by <a href=http://0x80.pl/notesen/2023-04-09-faster-parse-ipv4.html>Wojciech Muła&rsquo;s SIMD-ized IPv4 parsing research</a> and his <a href=https://github.com/WojciechMula/toys/tree/master/parseip4>complete SSE implementation</a>.</p><h2 id=related-blog-posts>Related Blog Posts</h2><ul><li><a href=../../blogs/go-spmd-ipv4-parser/>Putting It All Together: Fast IPv4 Parsing with SPMD Go</a> - Detailed explanation of this implementation</li><li><a href=../../blogs/cross-lane-communication/>Cross-Lane Communication: When Lanes Need to Talk</a> - Advanced SPMD patterns used here</li><li><a href=../../blogs/practical-vector/>Practical Vector Processing in Go</a> - Introduction to SPMD concepts and <code>reduce</code> operations</li></ul><ul class=pa0><li class="list di"><a href=/tags/golang/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Golang</a></li><li class="list di"><a href=/tags/performance/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Performance</a></li><li class="list di"><a href=/tags/networking/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Networking</a></li><li class="list di"><a href=/tags/simd/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">SIMD</a></li><li class="list di"><a href=/tags/spmd/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">SPMD</a></li></ul><div class="mt6 instapaper_ignoref"><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//bluebugs.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><div id=commento></div><script defer src=https://cdn.commento.io/js/commento.js></script></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/blogs/go-spmd-ipv4-parser/>Putting It All Together</a></li><li class=mb2><a href=/examples/base64-decoder/>Base64 Decoder - Complete Example</a></li></ul></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=http://bluebugs.github.io/>&copy; Cedric Bail 2025</a><div><div class=ananke-socials></div></div></div></footer></body></html>