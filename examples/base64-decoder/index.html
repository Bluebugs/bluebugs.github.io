<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>Base64 Decoder - Complete Example | Cedric Bail</title>
<meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Full SPMD base64 decoder with cross-lane communication"><meta name=generator content="Hugo 0.136.0"><meta name=robots content="index, follow"><meta name=author content="Cedric Bail"><link rel=stylesheet href=/ananke/css/main.min.b27b18f294c9951b5b631d08d9733f0d7794f951b8e49cdde160a91f5a65f320.css><link rel=canonical href=http://bluebugs.github.io/examples/base64-decoder/><meta property="og:url" content="http://bluebugs.github.io/examples/base64-decoder/"><meta property="og:site_name" content="Cedric Bail"><meta property="og:title" content="Base64 Decoder - Complete Example"><meta property="og:description" content="Full SPMD base64 decoder with cross-lane communication"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="examples"><meta property="article:published_time" content="2025-07-13T15:00:00-07:00"><meta property="article:modified_time" content="2025-07-13T15:00:00-07:00"><meta property="article:tag" content="Golang"><meta property="article:tag" content="Performance"><meta property="article:tag" content="Base64"><meta property="article:tag" content="SIMD"><meta property="article:tag" content="SPMD"><meta itemprop=name content="Base64 Decoder - Complete Example"><meta itemprop=description content="Full SPMD base64 decoder with cross-lane communication"><meta itemprop=datePublished content="2025-07-13T15:00:00-07:00"><meta itemprop=dateModified content="2025-07-13T15:00:00-07:00"><meta itemprop=wordCount content="713"><meta itemprop=keywords content="Golang,Performance,Base64,SIMD,SPMD"><meta name=twitter:card content="summary"><meta name=twitter:title content="Base64 Decoder - Complete Example"><meta name=twitter:description content="Full SPMD base64 decoder with cross-lane communication"></head><body class="ma0 avenir bg-near-white production"><header class="cover bg-center" style=background-image:url(http://bluebugs.github.io/images/bugaboo.jpg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Cedric Bail</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blogs/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/examples/ title="Code Examples page">Code Examples</a></li></ul><div class=ananke-socials></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><div class="f2 f1-l fw2 white-90 mb0 lh-title">Base64 Decoder - Complete Example</div><div class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">Full SPMD base64 decoder with cross-lane communication</div></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Code Examples</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">Base64 Decoder - Complete Example</h1><p class=tracked>By <strong>Cedric Bail</strong></p><time class="f6 mv4 dib tracked" datetime=2025-07-13T15:00:00-07:00>July 13, 2025</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links black pr4-l w-two-thirds-l"><p>This is the complete implementation of the base64 decoder discussed in <a href=../../blogs/cross-lane-communication/>Cross-Lane Communication: When Lanes Need to Talk</a>.</p><h2 id=complete-source-code>Complete Source Code</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// Package main demonstrates the SPMD Go decode function from vb64
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Based on: https://github.com/mcy/vb64/blob/main/src/simd.rs#L16-L144
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;lanes&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#e6db74>&#34;reduce&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Decode</span>(<span style=color:#a6e22e>ascii</span> []<span style=color:#66d9ef>byte</span>) ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>bool</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>ascii</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>true</span> <span style=color:#75715e>// No data to decode
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> len(<span style=color:#a6e22e>ascii</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>4</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>false</span> <span style=color:#75715e>// Base64 requires input length to be a multiple of 4 (could do with padding)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>decoded</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>byte</span>, <span style=color:#ae81ff>0</span>, len(<span style=color:#a6e22e>ascii</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pattern</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>outputPattern</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>v</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span>[<span style=color:#ae81ff>4</span>] <span style=color:#a6e22e>ascii</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>decodedChunk</span>, <span style=color:#a6e22e>valid</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>decodeChunk</span>(<span style=color:#a6e22e>v</span>, <span style=color:#a6e22e>pattern</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>valid</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#66d9ef>false</span> <span style=color:#75715e>// Invalid base64 input
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>decoded</span> = append(<span style=color:#a6e22e>decoded</span>, <span style=color:#a6e22e>decodedChunk</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>decoded</span>, <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// decode decodes `ascii` as base64. Returns the results of the decoding in the low
</span></span></span><span style=display:flex><span><span style=color:#75715e>// 3/4 of the returned vector, as well as whether decoding completed successfully.
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Direct translation of: pub fn decode&lt;const N: usize&gt;(ascii: Simd&lt;u8, N&gt;) -&gt; (Simd&lt;u8, N&gt;, bool)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>decodeChunk</span>(<span style=color:#a6e22e>ascii</span> <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>4</span>] <span style=color:#66d9ef>byte</span>, <span style=color:#a6e22e>pattern</span> <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>4</span>] <span style=color:#66d9ef>uint8</span>) ([]<span style=color:#66d9ef>byte</span>, <span style=color:#66d9ef>bool</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Perfect hash function: (c &gt;&gt; 4) - (c == &#39;/&#39;)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// This maps the five base64 categories as such:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//   A..=Z =&gt; 4 or 5,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//   a..=z =&gt; 6 or 7,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//   0..=9 =&gt; 3,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//   +     =&gt; 2,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//   /     =&gt; 1,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>// let hashes = (ascii &gt;&gt; Simd::splat(4))
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//   + Simd::simd_eq(ascii, Simd::splat(b&#39;/&#39;))
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//     .to_int()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//     .cast::&lt;u8&gt;();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>hashes</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>ShiftRight</span>(<span style=color:#a6e22e>ascii</span>, <span style=color:#ae81ff>4</span>) 
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ascii</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;/&#39;</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>hashes</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>	} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>hashes</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// let sextets = ascii + tiled(&amp;[!0, 16, 19, 4, 191, 191, 185, 185]).swizzle_dyn(hashes);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>offsetTable</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>byte</span>{<span style=color:#ae81ff>255</span>, <span style=color:#ae81ff>16</span>, <span style=color:#ae81ff>19</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>191</span>, <span style=color:#ae81ff>191</span>, <span style=color:#ae81ff>185</span>, <span style=color:#ae81ff>185</span>} <span style=color:#75715e>// !0 = 255
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>offsets</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>Swizzle</span>(<span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>From</span>(<span style=color:#a6e22e>offsetTable</span>), <span style=color:#a6e22e>hashes</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>sextets</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ascii</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>offsets</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Range validation using lookup tables
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// const LO_LUT: Simd&lt;u8, 16&gt; = Simd::from_array([
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//   0b10101, 0b10001, 0b10001, 0b10001, 0b10001, 0b10001, 0b10001, 0b10001,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//   0b10001, 0b10001, 0b10011, 0b11010, 0b11011, 0b11011, 0b11011, 0b11010,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// ]);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>loLUT</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>From</span>([]<span style=color:#66d9ef>byte</span>{
</span></span><span style=display:flex><span>		<span style=color:#ae81ff>0b10101</span>, <span style=color:#ae81ff>0b10001</span>, <span style=color:#ae81ff>0b10001</span>, <span style=color:#ae81ff>0b10001</span>, <span style=color:#ae81ff>0b10001</span>, <span style=color:#ae81ff>0b10001</span>, <span style=color:#ae81ff>0b10001</span>, <span style=color:#ae81ff>0b10001</span>,
</span></span><span style=display:flex><span>		<span style=color:#ae81ff>0b10001</span>, <span style=color:#ae81ff>0b10001</span>, <span style=color:#ae81ff>0b10011</span>, <span style=color:#ae81ff>0b11010</span>, <span style=color:#ae81ff>0b11011</span>, <span style=color:#ae81ff>0b11011</span>, <span style=color:#ae81ff>0b11011</span>, <span style=color:#ae81ff>0b11010</span>,
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// const HI_LUT: Simd&lt;u8, 16&gt; = Simd::from_array([
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//   0b10000, 0b10000, 0b00001, 0b00010, 0b00100, 0b01000, 0b00100, 0b01000,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>//   0b10000, 0b10000, 0b10000, 0b10000, 0b10000, 0b10000, 0b10000, 0b10000,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// ]);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>hiLUT</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>From</span>([]<span style=color:#66d9ef>byte</span>{
</span></span><span style=display:flex><span>		<span style=color:#ae81ff>0b10000</span>, <span style=color:#ae81ff>0b10000</span>, <span style=color:#ae81ff>0b00001</span>, <span style=color:#ae81ff>0b00010</span>, <span style=color:#ae81ff>0b00100</span>, <span style=color:#ae81ff>0b01000</span>, <span style=color:#ae81ff>0b00100</span>, <span style=color:#ae81ff>0b01000</span>,
</span></span><span style=display:flex><span>		<span style=color:#ae81ff>0b10000</span>, <span style=color:#ae81ff>0b10000</span>, <span style=color:#ae81ff>0b10000</span>, <span style=color:#ae81ff>0b10000</span>, <span style=color:#ae81ff>0b10000</span>, <span style=color:#ae81ff>0b10000</span>, <span style=color:#ae81ff>0b10000</span>, <span style=color:#ae81ff>0b10000</span>,
</span></span><span style=display:flex><span>	})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// let lo = swizzle::&lt;16, N&gt;(LO_LUT, ascii &amp; Simd::splat(0x0f));
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// let hi = swizzle::&lt;16, N&gt;(HI_LUT, ascii &gt;&gt; Simd::splat(4));
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>lo</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>Swizzle</span>(<span style=color:#a6e22e>loLUT</span>, <span style=color:#a6e22e>ascii</span> <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0x0f</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>hi</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>Swizzle</span>(<span style=color:#a6e22e>hiLUT</span>, <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>ShiftRight</span>(<span style=color:#a6e22e>ascii</span>, <span style=color:#ae81ff>4</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// let valid = (lo &amp; hi).reduce_or() == 0;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>valid</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reduce</span>.<span style=color:#a6e22e>Or</span>(<span style=color:#a6e22e>lo</span> <span style=color:#f92672>&amp;</span> <span style=color:#a6e22e>hi</span>) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Now we need to shift everything a little bit, since each byte has two high
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// bits it shouldn&#39;t that we need to delete. This follows the complex bit
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// manipulation from the Rust implementation:
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	
</span></span><span style=display:flex><span>	<span style=color:#75715e>// let shifted = sextets.cast::&lt;u16&gt;() &lt;&lt; tiled(&amp;[2, 4, 6, 8]);
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>shiftPattern</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>From</span>([]<span style=color:#66d9ef>uint16</span>{<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>6</span>, <span style=color:#ae81ff>8</span>})
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>shifted</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>ShiftLeft</span>(<span style=color:#a6e22e>sextets</span>, <span style=color:#a6e22e>shiftPattern</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// let lo = shifted.cast::&lt;u8&gt;();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// let hi = (shifted &gt;&gt; Simd::splat(8)).cast::&lt;u8&gt;();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>shiftedLo</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>4</span>] byte(<span style=color:#a6e22e>shifted</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>shiftedHi</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>4</span>] byte(<span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>ShiftRight</span>(<span style=color:#a6e22e>shifted</span>, <span style=color:#ae81ff>8</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// let decoded_chunks = lo | hi.rotate_lanes_left::&lt;1&gt;();
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>decodedChunks</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>shiftedLo</span> | <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>Rotate</span>(<span style=color:#a6e22e>shiftedHi</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// let output = swizzle!(N; decoded_chunks, array!(N; |i| i + i / 3));
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// The output pattern is skipping every 4th byte, which is why we use `i + i / 3`.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>output</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>lanes</span>.<span style=color:#a6e22e>Swizzle</span>(<span style=color:#a6e22e>decodedChunks</span>, <span style=color:#a6e22e>pattern</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> []byte(<span style=color:#a6e22e>output</span>), <span style=color:#a6e22e>valid</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>outputPattern</span>() <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>4</span>] <span style=color:#66d9ef>uint8</span> {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>r</span> <span style=color:#a6e22e>varying</span>[<span style=color:#ae81ff>4</span>] <span style=color:#66d9ef>uint8</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>go</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span>[<span style=color:#ae81ff>4</span>] {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>r</span>[<span style=color:#a6e22e>i</span>] = uint8(<span style=color:#a6e22e>i</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>/</span><span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>r</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span></code></pre></div><h2 id=usage-example>Usage Example</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>testCases</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>string</span>{
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;SGVsbG8gV29ybGQ=&#34;</span>, <span style=color:#75715e>// &#34;Hello World&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#e6db74>&#34;Zm9vYmFy&#34;</span>,         <span style=color:#75715e>// &#34;foobar&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#e6db74>&#34;YWJjZA==&#34;</span>,         <span style=color:#75715e>// &#34;abcd&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>tc</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>testCases</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>decoded</span>, <span style=color:#a6e22e>valid</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Decode</span>([]byte(<span style=color:#a6e22e>tc</span>))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>valid</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%-20s -&gt; ERROR: Invalid base64\n&#34;</span>, <span style=color:#a6e22e>tc</span>)
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%-20s -&gt; %s\n&#34;</span>, <span style=color:#a6e22e>tc</span>, string(<span style=color:#a6e22e>decoded</span>))
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=source-material>Source material</h2><p>This implementation is inspired by <a href=https://mcyoung.xyz/2023/11/27/simd-base64/>Miguel Young de la Sota&rsquo;s excellent analysis</a> in &ldquo;Designing a SIMD Algorithm from Scratch&rdquo; and adapted for the hypothetical SPMD Go extension.</p><h2 id=related-blog-posts>Related Blog Posts</h2><ul><li><a href=../../blogs/cross-lane-communication/>Cross-Lane Communication: When Lanes Need to Talk</a> - Detailed explanation of this implementation and the complexity trade-offs</li><li><a href=../../blogs/practical-vector/>Practical Vector Processing in Go</a> - Introduction to SPMD concepts and <code>reduce</code> operations</li></ul><ul class=pa0><li class="list di"><a href=/tags/golang/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Golang</a></li><li class="list di"><a href=/tags/performance/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Performance</a></li><li class="list di"><a href=/tags/base64/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">Base64</a></li><li class="list di"><a href=/tags/simd/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">SIMD</a></li><li class="list di"><a href=/tags/spmd/ class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">SPMD</a></li></ul><div class="mt6 instapaper_ignoref"><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//bluebugs.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><div id=commento></div><script defer src=https://cdn.commento.io/js/commento.js></script></div></div><aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links"><p class="f5 b mb3">Related</p><ul class="pa0 list"><li class=mb2><a href=/examples/ipv4-parser/>IPv4 Parser - Complete Example</a></li><li class=mb2><a href=/blogs/go-spmd-ipv4-parser/>Putting It All Together</a></li></ul></div></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=http://bluebugs.github.io/>&copy; Cedric Bail 2025</a><div><div class=ananke-socials></div></div></div></footer></body></html>