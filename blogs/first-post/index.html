<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>The SuperH family | Cedric Bail</title>
<meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="In depth SuperH instructions set"><meta name=generator content="Hugo 0.136.0"><meta name=robots content="index, follow"><meta name=author content="Cedric Bail"><link rel=stylesheet href=/ananke/css/main.min.b27b18f294c9951b5b631d08d9733f0d7794f951b8e49cdde160a91f5a65f320.css><link rel=canonical href=http://bluebugs.github.io/blogs/first-post/><meta property="og:url" content="http://bluebugs.github.io/blogs/first-post/"><meta property="og:site_name" content="Cedric Bail"><meta property="og:title" content="The SuperH family"><meta property="og:description" content="In depth SuperH instructions set"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2024-10-29T20:49:45-06:00"><meta property="article:modified_time" content="2024-10-29T20:49:45-06:00"><meta itemprop=name content="The SuperH family"><meta itemprop=description content="In depth SuperH instructions set"><meta itemprop=datePublished content="2024-10-29T20:49:45-06:00"><meta itemprop=dateModified content="2024-10-29T20:49:45-06:00"><meta itemprop=wordCount content="955"><meta name=twitter:card content="summary"><meta name=twitter:title content="The SuperH family"><meta name=twitter:description content="In depth SuperH instructions set"></head><body class="ma0 avenir bg-near-white production"><header class="cover bg-center" style=background-image:url(http://bluebugs.github.io/images/bugaboo.jpg)><div class=bg-black-60><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Cedric Bail</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/blogs/ title="Blog page">Blog</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/examples/ title="Code Examples page">Code Examples</a></li></ul><div class=ananke-socials></div></div></div></nav><div class="tc-l pv6 ph3 ph4-ns"><div class="f2 f1-l fw2 white-90 mb0 lh-title">The SuperH family</div><div class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">In depth SuperH instructions set</div></div></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked ttu">Blog</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">The SuperH family</h1><p class=tracked>By <strong>Cedric Bail</strong></p><time class="f6 mv4 dib tracked" datetime=2024-10-29T20:49:45-06:00>October 29, 2024</time></header><div class="nested-copy-line-height lh-copy serif f4 nested-links black pr4-l w-two-thirds-l"><p>In this post, I’ll explore the SuperH instruction set and its relevance today, along with a tool I created to navigate it.</p><p>A few years ago, I met some of the members of the team behind the development of the <em>J-Core</em>, a <em>SuperH</em> clone, and had some really interesting discussions with them. Using this <a href=http://www.shared-ptr.com/sh_insns.html>resource</a>, I created, for my own understanding, a <a href=https://bluebugs.github.io/json/insns.json>JSON file</a> and the dynamic table below to help me navigate and understand the <em>SuperH</em> instruction set. I also added J2-related instructions that were not present in the initial material. As I turn off my <em>AWS</em> account, I realized I could just share it via a <em>GitHub</em> page. Here is a bit more context about <em>SuperH</em>.</p><h1 id=the-evolution-of-_superh_>The Evolution of <em>SuperH</em></h1><p>The <em>SuperH</em> family was a fascinating family of CPUs. It emerged from the understanding of how CISC CPUs allowed for denser code with lower memory bandwidth, giving them an edge over RISC CPUs, despite RISC having the advantage of simpler instruction decoders. Engineers studied what instructions compilers were able to generate and selected those that led to more compact binaries. For that reason, <em>SuperH</em> has <strong>16-bit instructions</strong>, despite manipulating <strong>32-bit data</strong>, and these instructions can perform multiple operations. This allowed for array or stack manipulation, for example, with fewer instructions than a classic RISC CPU would require. It only has <strong>16 registers</strong>, but compilers are quite good at register allocation. <em>SuperH</em> ended up with a simpler decode stage than x86, for example, even though it uses microcode, while having code density comparable to the x86 family at the time.</p><p>The history of <em>SuperH</em> was cut short by the Asian economic crisis and never really recovered. It was present in many of the gaming consoles of the 90s, like the <a href=https://en.wikipedia.org/wiki/Sega_Saturn>Saturn</a> or <a href=https://en.wikipedia.org/wiki/Dreamcast>Dreamcast</a>. It was the predecessor to the Arm <a href=https://en.wikipedia.org/wiki/ARM_architecture#Thumb>Thumb</a> instruction set and the <a href=https://en.wikipedia.org/wiki/MIPS_architecture>MIPS16</a>. Today, all the patents related to the <em>SuperH</em> family have expired, enabling the start of its revival with the <em>J-Core</em> family for IoT devices.</p><h1 id=take-away>Take away</h1><p>As <em>SuperH</em> was designed to be more efficient at decoding instructions and using memory, I believe it would still have an edge and be relevant in any environment where energy and performance matter. Our main constraint for most computing use cases today is the ratio of energy to performance; this marks an important change over the last few decades. This ratio won’t improve in the future. The past advantage that x86 had with performance, regardless of other considerations, is now a hindrance, and the technological debt of this family makes it very difficult to compete with ARM, which has been much more focused on energy efficiency.</p><p>However, as a 90s CPU, bringing <em>SuperH</em> outside of the IoT scope would require figuring out how to:</p><ul><li><p><strong>Add a 64-bit memory mode</strong>: This would have a direct impact on memory bandwidth, as all pointers would instantly double in size, but it is required to run a lot of modern workload. Mixing 32-bit and 64-bit applications or perhaps developing ABI for libraries to support both modes would likely help. Most applications don&rsquo;t need more than 3GB of memory.</p></li><li><p><strong>Add SIMD instructions</strong>: SIMD allows for manipulating multiple data in parallel. They inherently have a high data-to-instruction ratio, which improves memory bandwidth usage for useful data. To compete with ARM, x86, or even RISC-V, you need SIMD instructions. Unfortunately, due to how poorly the software industry has made it to write data-parallel code, any new SIMD instruction set would require a large amount of hand-written code, representing a massive cost for any new architecture.</p></li><li><p><strong>Review the instructions generated for JIT</strong>: Today, we have a lot of software that performs <em>Just-In-Time</em> compilation (<em>JS</em> being one example, but also <em>QEMU</em>, which is useful for running non-native software). Such technologies didn’t exist in the 90s, so it would be beneficial to ensure that JIT workloads are well supported.</p></li><li><p><strong>Review the need for VMs</strong>: Again, in the 90s, VMs were not common. Today, VM workloads are the norm in data centers and on our laptops.</p></li><li><p><strong>Design a modern MMU/TLB that enables a large L1 cache</strong>: This requires a balance between memory waste and efficiency in accessing and using that memory while also ensuring that the software ecosystem can utilize it. Large L1 caches are possible with larger memory pages. Once you select a memory page size, the entire ecosystem becomes locked to that choice. x86 is significantly impacted by the 4KB page limit today, which Apple’s ARM hardware has managed to bypass.</p></li></ul><p>Even with a full <em>Debian</em> running today on the <em>SuperH</em> family, it would take a lot of work to bring the <em>SuperH</em> family to handle modern workloads outside of IoT. Nevertheless, I believe that as computing workloads become increasingly constrained by energy, the <em>SuperH</em> family—or at least its concepts—will be more relevant than ever.</p><p>Have fun exploring the instruction set below. You can filter, search, and tag (locally stored) through the instruction set.</p><script type=text/javascript src=https://s3.amazonaws.com/dynatable-docs-assets/js/jquery-1.9.1.min.js></script><script type=text/javascript src=https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.scrollTo.js></script><script type=text/javascript src=https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.toc.min.js></script><script type=text/javascript src=https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.sharrre-1.2.0.min.js></script><script type=text/javascript src=https://s3.amazonaws.com/dynatable-docs-assets/js/jquery.dynatable.js></script><style type=text/css>.horizontal{display:inline-flex;flex-direction:row;justify-content:space-between;width:60%}#filter-family{order:1}#insns-group{order:2}.search{order:3}.remember{order:4}.remember label{display:inline-block;padding-right:10px;white-space:nowrap}.remember input{vertical-align:middle}.remember label span{vertical-align:middle}.vertical{display:flex;flex-direction:column}#horizontal{order:-1}#instructions{flex-grow:1;order:3}#dynatable-record-count{order:2}*{padding:3px;border:none;border-collapse:collapse;border-spacing:0}.top{border-top-width:1px;border-top-style:dotted}.collapse{font-family:monospace;white-space:pre-wrap;font-size:11px;display:none}.header{background-color:#d0d0d0}.header a{color:#000;font-size:18px;font-weight:700;font-style:italic}.compat{font-size:9px;overflow:hidden;font-family:monospace;color:#000;white-space:pre-wrap;text-align:left}.family{font-size:9px;overflow:hidden;font-family:monospace;color:gray;white-space:pre-wrap;text-align:left}.family a{color:gray;font-size:13px;text-decoration:none}pre.code{font-size:11px;font-family:monospace}.dynatable-record-count{color:gray}</style><h2>Renesas SH Instruction Set Summary</h2><script type=text/javascript>var remember,itr,local_storage=!1;typeof Storage!="undefined"?(local_storage=!0,console.log(`We do have storage.
`),remember=JSON.parse(window.localStorage.getItem("remember")),remember===null&&(remember=new Object)):console.log(`we don't have storage :-(
`),itr=0;function update_remember(){document.getElementById("chk_remember").checked?$("#remember").val(!0):$("#remember").val(!1),$("#remember").trigger(jQuery.Event("keypress",{which:13}))}</script><div class=vertical><div class=horizontal id=horizontal><div id=filter-family>Family :
<select id=family name=family><option>*</option><option>SH1</option><option>SH2</option><option>SH2E</option><option>SH2A</option><option>SH3</option><option>SH3E</option><option>SH4</option><option>SH4A</option><option>DSP</option><option>J-Core</option></select></div><div id=insns-group>Instructions group :
<select id=group name=group><option>*</option><option>Data Transfer Instructions</option><option>Bit Manipulation Instructions</option><option>Arithmetic Operation Instructions</option><option>Logic Operation Instructions</option><option>Shift Instructions</option><option>Branch Instructions</option><option>System Control Instructions</option><option>32 Bit Floating-Point Data Transfer Instructions (FPSCR.SZ = 0)</option><option>64 Bit Floating-Point Data Transfer Instructions (FPSCR.SZ = 1)</option><option>Floating-Point Single-Precision Instructions (FPSCR.PR = 0)</option><option>Floating-Point Double-Precision Instructions (FPSCR.PR = 1)</option><option>Floating-Point Control Instructions</option><option>DSP Data Transfer Instructions</option><option>DSP ALU Arithmetic Operation Instructions</option><option>DSP ALU Logical Operation Instructions</option><option>DSP Fixed Decimal Point Multiplication Instructions</option><option>DSP Shift Operation Instructions</option><option>DSP System Control Instructions</option></select></div><div class=search>Matching regexp :
<input type=search id=search></div><div class=remember><input type=search id=remember value=false>
<label><input type=checkbox id=chk_remember onclick=update_remember()><span>Stared</span></label></div></div><table id=instructions><thead class=header id=top_header><th colspan=3>Compatibility</th><th>Format</th><th>Abstract</th><th>Code</th><th>T Bits</br>DC Bits</th><th colspan=3>Issue cycles</th><th colspan=3>Latency cycles</th><script type=text/javascript>local_storage&&document.write("<th data-dynatable-column='remember'>Remember</th>")</script></thead><thead class=header><th colspan=7></th><th class=family data-dynatable-column=SH4.issue>SH1</th><th class=family data-dynatable-column=SH2.issue>SH2</th><th class=family data-dynatable-column=SH2E.issue>SH2E</th><th class=family data-dynatable-column=SH4.issue>SH1</th><th class=family data-dynatable-column=SH2.issue>SH2</th><th class=family data-dynatable-column=SH2E.issue>SH2E</th><script type=text/javascript>local_storage&&document.write("<th></th>")</script></thead><thead class=header><th colspan=7></th><th class=family data-dynatable-column=SH4.issue>SH2A</th><th class=family data-dynatable-column=SH3.issue>SH3</th><th class=family data-dynatable-column=SH3E.issue>SH3E</th><th class=family data-dynatable-column=SH4.issue>SH2A</th><th class=family data-dynatable-column=SH3.issue>SH3</th><th class=family data-dynatable-column=SH3E.issue>SH3E</th><script type=text/javascript>local_storage&&document.write("<th></th>")</script></thead><thead class=header><th colspan=7></th><th class=family data-dynatable-column=SH4.issue>SH4</th><th class=family data-dynatable-column=SH4A.issue>SH4A</th><th class=family data-dynatable-column=DSP.issue>DSP</th><th class=family data-dynatable-column=SH4.latency>SH4</th><th class=family data-dynatable-column=SH4A.latency>SH4A</th><th class=family data-dynatable-column=DSP.lantency>DSP</th><script type=text/javascript>local_storage&&document.write("<th></th>")</script></thead><thead class=header><th colspan=7></th><th class=family data-dynatable-column=J32.issue>J32</th><th class=family></th><th class=family></th><th class=family data-dynatable-column=J32.latency>J32</th><th class=family></th><th class=family></th><script type=text/javascript>local_storage&&document.write("<th></th>")</script></thead><tbody></tbody></table></div><script type=text/javascript>var ConvertBase,last_group,last_query,last_rex,dynatable,cur_opened=null;document.getElementById("remember").style.display="none";function on_remember(e,t,n){if(n.defaultPrevented===!0)return;remember[t]===!0?(delete remember[t],s=!1):(remember[t]=!0,s=!0),window.localStorage.setItem("remember",JSON.stringify(remember));var s,o=document.getElementById("remember"+e);o.setAttribute("src",remember[t]===!0?"/images/star_icon-full.png":"/images/star_icon-empty.png"),dynatable.settings.dataset.originalRecords[e].remember=s,n.preventDefault()}function on_mouse_click(e,t){if(t.defaultPrevented===!0)return;var n=document.getElementById("hex"+e),s=document.getElementById("description"+e),o=document.getElementById("operation"+e),i=window.getSelection();if(!i.isCollapsed)return;s.style.display=="table-row"?(n&&(n.style.display="none"),s.style.display="none",o.style.display="none",cur_opened=null):(n&&(n.style.display="table-row"),s.style.display="table-row",o.style.display="table-row",cur_opened!=null&&(cur_opened[0]&&(cur_opened[0].style.display="none"),cur_opened[1].style.display="none",cur_opened[2].style.display="none"),cur_opened=[n,s,o])}function on_mouse_over(e){var t,n,s;document.getElementById("line0."+e).style.backgroundColor="#F0F0F0",document.getElementById("line1."+e).style.backgroundColor="#F0F0F0",document.getElementById("line2."+e).style.backgroundColor="#F0F0F0",document.getElementById("line3."+e).style.backgroundColor="#F0F0F0",t=document.getElementById("hex"+e),t&&(t.style.backgroundColor="#F0F0F0"),n=document.getElementById("description"+e),n&&(n.style.backgroundColor="#F0F0F0"),s=document.getElementById("operation"+e),s&&(s.style.backgroundColor="#F0F0F0")}function on_mouse_out(e){var t,n,s;document.getElementById("line0."+e).style.backgroundColor="",document.getElementById("line1."+e).style.backgroundColor="",document.getElementById("line2."+e).style.backgroundColor="",document.getElementById("line3."+e).style.backgroundColor="",t=document.getElementById("hex"+e),t&&(t.style.backgroundColor=""),n=document.getElementById("description"+e),n&&(n.style.backgroundColor=""),s=document.getElementById("operation"+e),s&&(s.style.backgroundColor="")}function extract_4c(e){half_bytes=[],e=e.replace(" ","");for(var t=0,n=e.length;t<n;t+=4)half_bytes.push(e.substring(t,t+4));return half_bytes}ConvertBase=function(e){return{from:function(t){return{to:function(n){return parseInt(e,t).toString(n)}}}}};function binary2hex(e){const t=extract_4c(e);hex=[];for(const e of t)if(/^[01]+$/.test(e))hex.push(ConvertBase(e).from(2).to(16));else if(e==="nnnn")hex.push("n");else if(e==="mmmm")hex.push("m");else if(e==="iiii")hex.push("i");else if(e==="dddd")hex.push("d");else return null;const n=extract_4c(hex.join("").toUpperCase());return n.join(" ")}last_group="";function Writer(e,t){var o=[t.SH1?"SH1":"-",t.SH2?"SH2":"-",t.SH2E?"SH2E":"-",t.SH2A?"SH2A":"-",t.SH3?"SH3":"-",t.SH3E?"SH3E":"-",t.SH4?"SH4":"-",t.SH4A?"SH4A":"-",t.DSP?"DSP":"-",t.J32?"J32":"-"],i=[t.SH1?t["SH1.issue"]:"-",t.SH2?t["SH2.issue"]:"-",t.SH2E?t["SH2E.issue"]:"-",t.SH2A?t["SH2A.issue"]:"-",t.SH3?t["SH3.issue"]:"-",t.SH3E?t["SH3E.issue"]:"-",t.SH4?t["SH4.issue"]:"-",t.SH4A?t["SH4A.issue"]:"-",t.DSP?t["DSP.issue"]:"-",t.J32?t["J32.issue"]:"-"],a=[t.SH1?t["SH1.latency"]:"-",t.SH2?t["SH2.latency"]:"-",t.SH2E?t["SH2E.latency"]:"-",t.SH2A?t["SH2A.latency"]:"-",t.SH3?t["SH3.latency"]:"-",t.SH3E?t["SH3E.latency"]:"-",t.SH4?t["SH4.latency"]:"-",t.SH4A?t["SH4A.latency"]:"-",t.DSP?t["DSP.latency"]:"-",t.J32?t["J32.latency"]:"-"],r="";return local_storage?(memory='<td rowspan=4><a onclick="on_remember('+e+", '"+String(t.format)+`', event);"><img id="remember`+e+'" height=32 width=32 src="/images/star_icon-',remember[String(t.format)]===!0?(memory+="full",t.remember=!0):(memory+="empty",t.remember=!1),memory+='.png"></a></td>',colspan=14):(memory="",colspan=13),t.group!=last_group&&(last_group=t.group,r="<tr><td colspan="+colspan+"><br/><b>"+t.group+"</b><br/></td></tr>"),t.hex=binary2hex(t.code),t.hex?hexCode='<tr class="collapse" id="hex'+e+'" onmouseover="on_mouse_over('+e+');" onmouseout="on_mouse_out('+e+');" onclick="on_mouse_click('+e+', event);"><td colspan='+colspan+"><i><b>Short hexadecimal instruction code:</i></b>&nbsp;"+t.hex+"</td></tr>":hexcode="",r+'<tr class="top" id="line0.'+e+'" onmouseover="on_mouse_over('+e+');" onmouseout="on_mouse_out('+e+');" onclick="on_mouse_click('+e+', event);"><td class="compat">'+o[0]+'</td><td class="compat">'+o[1]+'</td><td class="compat">'+o[2]+"</td><td rowspan=4>"+t.format+"</td><td rowspan=4>"+t.abstract+"</td><td rowspan=4><pre>"+t.code+"</pre></td><td rowspan=4>"+t.T+"</td><td>"+i[0]+"</td><td>"+i[1]+"</td><td>"+i[2]+"</td><<td>"+a[0]+"</td><td>"+a[1]+"</td><td>"+a[2]+"</td>"+memory+'</tr><tr id="line1.'+e+'" onmouseover="on_mouse_over('+e+');" onmouseout="on_mouse_out('+e+');" onclick="on_mouse_click('+e+', event);"><td class="compat">'+o[3]+'</td><td class="compat">'+o[4]+'</td><td class="compat">'+o[5]+"</td><td>"+i[3]+"</td><td>"+i[4]+"</td><td>"+i[5]+"</td><td>"+a[3]+"</td><td>"+a[4]+"</td><td>"+a[5]+'</td></tr><tr id="line2.'+e+'" onmouseover="on_mouse_over('+e+');" onmouseout="on_mouse_out('+e+');" onclick="on_mouse_click('+e+', event);"><td class="compat">'+o[6]+'</td><td class="compat">'+o[7]+'</td><td class="compat">'+o[8]+"</td><td>"+i[6]+"</td><td>"+i[7]+"</td><td>"+i[8]+"</td><td>"+a[6]+"</td><td>"+a[7]+"</td><td>"+a[8]+'</td></tr><tr id="line3.'+e+'" onmouseover="on_mouse_over('+e+');" onmouseout="on_mouse_out('+e+');" onclick="on_mouse_click('+e+', event);"><td class="compat">'+o[9]+'</td><td class="compat"></td><td class="compat"></td><td>'+i[9]+"</td><td></td><td></td><td>"+a[9]+"</td><td></td><td></td></tr>"+hexCode+'<tr class="collapse" id="description'+e+'" onmouseover="on_mouse_over('+e+');" onmouseout="on_mouse_out('+e+');" onclick="on_mouse_click('+e+', event);"><td colspan='+colspan+"><i><b>Description</i></b><br/><pre>"+t.description+'</pre></td></tr><tr class="collapse" id="operation'+e+'" onmouseover="on_mouse_over('+e+');" onmouseout="on_mouse_out('+e+');" onclick="on_mouse_click('+e+', event);"><td colspan='+colspan+'><i><b>Operation</i></b><pre class="code">'+t.operation+"</pre></td></tr>"}last_query="",last_rex=null,dynatable=null,$.getJSON("/json/insns.json",function(e){dynatable=$("#instructions").bind("dynatable:init",function(e,t){t.queries.functions.family=function(e,t){return t==="*"||(t==="J-Core"?e.J32:e[t]===!0)},t.queries.functions.group=function(e,t){return t==="*"||e.group===t},t.queries.functions.search=function(e,t){if(t.length==0)return!0;t!=last_query&&(last_query=t,last_rex=new RegExp(t));var n=last_rex;return!!n.test(e.format)||!!n.test(e.abstract)||!!n.test(e.code)||!!n.test(e.description)||!!n.test(e.operation)||!!n.test(e.group)||!!n.test(e.hex)},t.queries.functions.remember=function(e,t){return t!=="true"||!!e.remember}}).dynatable({features:{search:!1,paginate:!1},writers:{_rowWriter:Writer},dataset:{records:e.instructions},inputs:{queries:$("#family, #search, #group, #remember")}}).data("dynatable")})</script><ul class=pa0></ul><div class="mt6 instapaper_ignoref"><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//bluebugs.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><div id=commento></div><script defer src=https://cdn.commento.io/js/commento.js></script></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=http://bluebugs.github.io/>&copy; Cedric Bail 2025</a><div><div class=ananke-socials></div></div></div></footer></body></html>